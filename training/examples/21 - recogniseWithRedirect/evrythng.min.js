!function(a,b){"function"==typeof define&&define.amd?define(b(XMLHttpRequest)):"object"==typeof exports?module.exports=b(require("w3c-xmlhttprequest").XMLHttpRequest):a.EVT=a.Evrythng=b(XMLHttpRequest)}(this,function(a){var b,c,d;return function(a){function e(a,b){return u.call(a,b)}function f(a,b){var c,d,e,f,g,h,i,j,k,l,m,n=b&&b.split("/"),o=s.map,p=o&&o["*"]||{};if(a&&"."===a.charAt(0))if(b){for(n=n.slice(0,n.length-1),a=a.split("/"),g=a.length-1,s.nodeIdCompat&&w.test(a[g])&&(a[g]=a[g].replace(w,"")),a=n.concat(a),k=0;k<a.length;k+=1)if(m=a[k],"."===m)a.splice(k,1),k-=1;else if(".."===m){if(1===k&&(".."===a[2]||".."===a[0]))break;k>0&&(a.splice(k-1,2),k-=2)}a=a.join("/")}else 0===a.indexOf("./")&&(a=a.substring(2));if((n||p)&&o){for(c=a.split("/"),k=c.length;k>0;k-=1){if(d=c.slice(0,k).join("/"),n)for(l=n.length;l>0;l-=1)if(e=o[n.slice(0,l).join("/")],e&&(e=e[d])){f=e,h=k;break}if(f)break;!i&&p&&p[d]&&(i=p[d],j=k)}!f&&i&&(f=i,h=j),f&&(c.splice(0,h,f),a=c.join("/"))}return a}function g(b,c){return function(){var d=v.call(arguments,0);return"string"!=typeof d[0]&&1===d.length&&d.push(null),n.apply(a,d.concat([b,c]))}}function h(a){return function(b){return f(b,a)}}function i(a){return function(b){q[a]=b}}function j(b){if(e(r,b)){var c=r[b];delete r[b],t[b]=!0,m.apply(a,c)}if(!e(q,b)&&!e(t,b))throw new Error("No "+b);return q[b]}function k(a){var b,c=a?a.indexOf("!"):-1;return c>-1&&(b=a.substring(0,c),a=a.substring(c+1,a.length)),[b,a]}function l(a){return function(){return s&&s.config&&s.config[a]||{}}}var m,n,o,p,q={},r={},s={},t={},u=Object.prototype.hasOwnProperty,v=[].slice,w=/\.js$/;o=function(a,b){var c,d=k(a),e=d[0];return a=d[1],e&&(e=f(e,b),c=j(e)),e?a=c&&c.normalize?c.normalize(a,h(b)):f(a,b):(a=f(a,b),d=k(a),e=d[0],a=d[1],e&&(c=j(e))),{f:e?e+"!"+a:a,n:a,pr:e,p:c}},p={require:function(a){return g(a)},exports:function(a){var b=q[a];return"undefined"!=typeof b?b:q[a]={}},module:function(a){return{id:a,uri:"",exports:q[a],config:l(a)}}},m=function(b,c,d,f){var h,k,l,m,n,s,u=[],v=typeof d;if(f=f||b,"undefined"===v||"function"===v){for(c=!c.length&&d.length?["require","exports","module"]:c,n=0;n<c.length;n+=1)if(m=o(c[n],f),k=m.f,"require"===k)u[n]=p.require(b);else if("exports"===k)u[n]=p.exports(b),s=!0;else if("module"===k)h=u[n]=p.module(b);else if(e(q,k)||e(r,k)||e(t,k))u[n]=j(k);else{if(!m.p)throw new Error(b+" missing "+k);m.p.load(m.n,g(f,!0),i(k),{}),u[n]=q[k]}l=d?d.apply(q[b],u):void 0,b&&(h&&h.exports!==a&&h.exports!==q[b]?q[b]=h.exports:l===a&&s||(q[b]=l))}else b&&(q[b]=d)},b=c=n=function(b,c,d,e,f){if("string"==typeof b)return p[b]?p[b](c):j(o(b,c).f);if(!b.splice){if(s=b,s.deps&&n(s.deps,s.callback),!c)return;c.splice?(b=c,c=d,d=null):b=a}return c=c||function(){},"function"==typeof d&&(d=e,e=f),e?m(a,b,c,d):setTimeout(function(){m(a,b,c,d)},4),n},n.config=function(a){return n(a)},b._defined=q,d=function(a,b,c){b.splice||(c=b,b=[]),e(q,a)||e(r,a)||(r[a]=[a,b,c])},d.amd={jQuery:!0}}(),d("almond",function(){}),d("npo",[],function(){function a(a,b){l.add(a,b),k||(k=n(l.drain))}function b(a){var b,c=typeof a;return null==a||"object"!=c&&"function"!=c||(b=a.then),"function"==typeof b?b:!1}function c(){for(var a=0;a<this.chain.length;a++)d(this,1===this.state?this.chain[a].success:this.chain[a].failure,this.chain[a]);this.chain.length=0}function d(a,c,d){var e,f;try{c===!1?d.reject(a.msg):(e=c===!0?a.msg:c.call(void 0,a.msg),e===d.promise?d.reject(TypeError("Promise-chain cycle")):(f=b(e))?f.call(e,d.resolve,d.reject):d.resolve(e))}catch(g){d.reject(g)}}function e(d){var g,i,j=this;if(!j.triggered){j.triggered=!0,j.def&&(j=j.def);try{(g=b(d))?(i=new h(j),g.call(d,function(){e.apply(i,arguments)},function(){f.apply(i,arguments)})):(j.msg=d,j.state=1,j.chain.length>0&&a(c,j))}catch(k){f.call(i||new h(j),k)}}}function f(b){var d=this;d.triggered||(d.triggered=!0,d.def&&(d=d.def),d.msg=b,d.state=2,d.chain.length>0&&a(c,d))}function g(a,b,c,d){for(var e=0;e<b.length;e++)!function(e){a.resolve(b[e]).then(function(a){c(e,a)},d)}(e)}function h(a){this.def=a,this.triggered=!1}function i(a){this.promise=a,this.state=0,this.triggered=!1,this.chain=[],this.msg=void 0}function j(b){if("function"!=typeof b)throw TypeError("Not a function");if(0!==this.__NPO__)throw TypeError("Not a promise");this.__NPO__=1;var d=new i(this);this.then=function(b,e){var f={success:"function"==typeof b?b:!0,failure:"function"==typeof e?e:!1};return f.promise=new this.constructor(function(a,b){if("function"!=typeof a||"function"!=typeof b)throw TypeError("Not a function");f.resolve=a,f.reject=b}),d.chain.push(f),0!==d.state&&a(c,d),f.promise},this["catch"]=function(a){return this.then(void 0,a)};try{b.call(void 0,function(a){e.call(d,a)},function(a){f.call(d,a)})}catch(g){f.call(d,g)}}var k,l,m=Object.prototype.toString,n="undefined"!=typeof setImmediate?function(a){return setImmediate(a)}:setTimeout,o=Object.defineProperty?function(a,b,c,d){return Object.defineProperty(a,b,{value:c,writable:!0,configurable:d!==!1})}:function(a,b,c){return a[b]=c,a};l=function(){function a(a,b){this.fn=a,this.self=b,this.next=void 0}var b,c,d;return{add:function(e,f){d=new a(e,f),c?c.next=d:b=d,c=d,d=void 0},drain:function(){var a=b;for(b=c=k=void 0;a;)a.fn.call(a.self),a=a.next}}}();var p=o({},"constructor",j,!1);return o(j,"prototype",p,!1),o(p,"__NPO__",0,!1),o(j,"resolve",function(a){var b=this;return a&&"object"==typeof a&&1===a.__NPO__?a:new b(function(b,c){if("function"!=typeof b||"function"!=typeof c)throw TypeError("Not a function");b(a)})}),o(j,"reject",function(a){return new this(function(b,c){if("function"!=typeof b||"function"!=typeof c)throw TypeError("Not a function");c(a)})}),o(j,"all",function(a){var b=this;return"[object Array]"!=m.call(a)?b.reject(TypeError("Not an array")):0===a.length?b.resolve([]):new b(function(c,d){if("function"!=typeof c||"function"!=typeof d)throw TypeError("Not a function");var e=a.length,f=Array(e),h=0;g(b,a,function(a,b){f[a]=b,++h===e&&c(f)},d)})}),o(j,"race",function(a){var b=this;return"[object Array]"!=m.call(a)?b.reject(TypeError("Not an array")):new b(function(c,d){if("function"!=typeof c||"function"!=typeof d)throw TypeError("Not a function");g(b,a,function(a,b){c(b)},d)})}),j}),d("utils",["npo"],function(a){return{isFunction:function(a){return"[object Function]"==Object.prototype.toString.call(a)},isString:function(a){return"[object String]"==Object.prototype.toString.call(a)},isArray:function(a){return"[object Array]"==Object.prototype.toString.call(a)},isObject:function(a){return a===Object(a)&&!this.isArray(a)},extend:function(a,b,c){var d;if(c)d=a;else{d={};for(var e in a)d[e]=a[e]}for(var f in b)b.hasOwnProperty(f)&&(d[f]=b[f]);return d},buildParams:function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&void 0!==a[c]&&b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")},buildUrl:function(a){var b=a.url||"";return a.params&&(b+=(-1===b.indexOf("?")?"?":"&")+this.buildParams(a.params)),b},getCurrentPosition:function(b){if("undefined"!=typeof window&&window.navigator.geolocation){var c=this.extend({maximumAge:0,timeout:1e4,enableHighAccuracy:!0},b);return new a(function(a,b){window.navigator.geolocation.getCurrentPosition(function(b){a(b)},function(a){var c="Geolocation: ";c=1===a.code?"You didn't share your location.":2===a.code?"Couldn't detect your current location.":3===a.code?"Retrieving position timed out.":"Unknown error.",b(c)},c)})}return new a(function(a,b){b("Your browser/environment doesn't support geolocation.")})}}}),d("core",["utils"],function(a){var b="2.0.8",c={apiUrl:"https://api.evrythng.com",async:!0,fullResponse:!1,quiet:!1,geolocation:!0},d={version:b,settings:c,setup:function(b){if(!a.isObject(b))throw new TypeError("Setup should be called with an options object.");return this.settings=a.extend(this.settings,b),this.settings}};return d}),d("scope/scope",["utils"],function(a){var b=function(b){if(this.parentScope=null,!a.isString(b))throw new TypeError("Scope constructor should be called with API Key.");this.apiKey=b};return b}),d("logger",["core"],function(a){var b="EvrythngJS";return{error:function(c){a.settings.quiet===!1&&console.error(b+" Error:",c)},info:function(c){a.settings.quiet===!1&&console.info(b+" Info:",c)}}}),d("ajax/cors",["core","npo","utils","logger"],function(b,c,d,e){function f(a,b){var c=a.responseText?JSON.parse(a.responseText):null;if(b){var d=function(a){a=a.trim().split("\n");var b={},c=function(a){return(a||"").toLowerCase().replace(/(\b|-)\w/g,function(a){return a.toUpperCase()})};for(var d in a){var e=a[d].match(/([^:]+):(.*)/);b[c(e[1]).trim()]=e[2].trim()}return b};c={data:c,headers:d(a.getAllResponseHeaders()),status:a.status},c.data&&c.data.errors&&(c.errors=c.data.errors,delete c.data.errors)}return c}function g(a,b,c,d){var e={status:a.status,type:"cors",message:"Server responded with an error for the CORS request",url:b,method:c};return d&&(e.errors=d.errors),e}function h(b,c,d,e){var f=new a;return f.open(b,c,d),f.setRequestHeader("Content-Type","application/json"),e.authorization&&f.setRequestHeader("Authorization",e.authorization),e.timeout>0&&(f.timeout=e.timeout),f}function i(a,b,i){a=a||{};var j=a.method||"get",k=d.buildUrl(a),l=void 0!==a.async?a.async:!0,m=h(j,k,l,a),n=a.data?JSON.stringify(a.data):null;if(l)return new c(function(c,d){function h(){try{if(this.readyState===this.DONE){var d=f(this,a.fullResponse);this.status>=200&&this.status<300?(b&&b(d),c(d)):l(d)}}catch(e){}}m.onerror=function(){var a=new Error("Network error.");a.name="CorsError",d(a)};var l=function(a){if(a){var b=g(m,k,j,a);e.error(b),i&&i(b),d(b)}};a.timeout>0&&(m.ontimeout=function(){var a={errors:["Request timed out."]};l(a)}),m.onreadystatechange=h,m.send(n)});m.send(n);var o=f(m,a.fullResponse);if(m.status>=200&&m.status<300)return o;throw e.error(g(m,k,j,o)),new Error("Synchronous CORS Request failed.")}return i}),d("ajax/jsonp",["core","npo","utils","logger"],function(a,b,c,d){function e(a,b,c,d){var e={status:b,type:"jsonp",message:"Server responded with an error for the JSONP request",url:a,method:c};return d&&(e.errors=d.errors),e}function f(a,b){var c=document.createElement("script"),d=!1;c.src=a,c.async=b,c.onload=c.onreadystatechange=function(){d||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(d=!0,c.onload=c.onreadystatechange=null,c&&c.parentNode&&c.parentNode.removeChild(c))},h||(h=document.getElementsByTagName("head")[0]),h.appendChild(c)}function g(a,g,h){a=a||{},a.url&&(a.url=a.url.replace("//api","//js-api"));var j="callback_json"+ ++i,k=a.params||{};k.callback=j,k.access_token=a.authorization,k.method=a.method||"get",k.data=JSON.stringify(a.data),a.params=k;var l=void 0!==a.async?a.async:!0,m=c.buildUrl(a);return new b(function(a,b){window[j]=function(c){if(c.errors&&c.status){var f=e(m,c.status,k.method,c);d.error(f),h&&h(f),b(f)}else g&&g(c),a(c);try{delete window[j]}catch(i){}window[j]=null},f(m,l,b)})}var h,i=0;return g}),d("ajax",["core","ajax/cors","ajax/jsonp","utils","logger"],function(b,c,d,e,f){function g(g,h,i){var j=e.extend({async:b.settings.async,fullResponse:b.settings.fullResponse,authorization:b.settings.apiKey,timeout:b.settings.timeout},g);j.url=b.settings.apiUrl+j.url;var k,l;e.isFunction(h)?k=h:e.isFunction(g.success)&&(k=g.success),e.isFunction(i)?l=i:e.isFunction(g.error)&&(l=g.error);var m="boolean"==typeof(new a).withCredentials;return m?c(j,k,l):(f.info("CORS not supported, falling back to JSONP."),d(j,k,l))}return b.api=g,b}),d("resource",["core","npo","scope/scope","utils","logger","ajax"],function(a,b,c,d,e){function f(b,c,e,f){var h,i=e,j=f;return d.isFunction(c)||null===c?(i=c,j=e):d.isObject(c)&&(b=d.extend(b,c)),h=a.api(b,i,j),g.call(this,h,c)}function g(b,c){var d=c&&void 0!==c.async?c.async:a.settings.async;if(d){var e=this;return b.then(function(a){return e.parse(a)})}return b}var h=function(a,b,f){if(!(a&&a instanceof c))throw new TypeError("Scope should inherit from Scope (e.g. EVT.App).");if(this.scope=a,!d.isString(b))throw new TypeError("Resource must have a String path.");"/"!=b[0]&&(b="/"+b),this.path=b,d.isFunction(f)?d.isFunction(f.prototype.toJSON)?this["class"]=f:e.error('Class for resource "'+b+'" does not implement toJSON().'):e.info('Class for resource "'+b+'" undefined. It will not return proper Entities nor cascaded Entities.')};return h.prototype.parse=function(a){if(this["class"]&&a){var b=this;if(d.isObject(a)&&a.hasOwnProperty("data"))return a.data=b.parse(a.data),d.isObject(a.headers)&&d.isString(a.headers["X-Result-Count"])&&(a.count=parseInt(a.headers["X-Result-Count"])),a;if(d.isArray(a)){var c=[];for(var e in a)if(a.hasOwnProperty(e)){var f=a[e].id;f&&(b=new h(b.scope,b.path+"/"+f,b["class"])),c.push(new b["class"](a[e],b))}return c}return new this["class"](a,this)}return a},h.prototype.jsonify=function(a){return this["class"]&&a instanceof this["class"]?a.toJSON():a},h.prototype.create=function(a,b,c,e){if(!a||d.isFunction(a))throw new TypeError("Create method should have payload.");var g={url:this.path,method:"post",authorization:this.scope.apiKey,data:this.jsonify(a)};return f.call(this,g,b,c,e)},h.prototype.read=function(a,b,c){var d={url:this.path,authorization:this.scope.apiKey};return f.call(this,d,a,b,c)},h.prototype.count=function(a,c,d){var e={url:this.path,authorization:this.scope.apiKey,fullResponse:!0,params:{perPage:1,page:1}};return f.call(this,e,a,c,d).then(function(a){return new b(function(b,c){void 0!==a.count?b(a.count):c(new TypeError("Resource must be a collection."))})})},h.prototype.update=function(a,b,c,e){if(!a||d.isFunction(a))throw new TypeError("Update method should have payload.");var g={url:this.path,method:"put",authorization:this.scope.apiKey,data:this.jsonify(a)};return f.call(this,g,b,c,e)},h.prototype["delete"]=function(a,b,c){var d={url:this.path,method:"delete",authorization:this.scope.apiKey};return f.call(this,d,a,b,c)},h.constructorFactory=function(a,b){return function(c){var e=a||"";if(c){if(!d.isString(c))throw new TypeError("ID must be a string");e+="/"+c}return new h(this,e,b)}},h}),d("entity/entity",["resource","utils"],function(a,b){var c=function(c,d){b.isObject(c)&&(c instanceof a?this.resource=c:(this.resource=d,b.extend(this,c,!0)))};return c.prototype.toJSON=function(){var a={};for(var c in this)this[c]&&!b.isFunction(this[c])&&"resource"!=c&&(a[c]=this[c]);return a},c.prototype.update=function(a){if(this.resource){var c=arguments,d=this;return(null===a||!a||b.isFunction(a))&&(c=Array.prototype.slice.call(arguments,0),c.unshift(this.toJSON())),this.resource.update.apply(this.resource,c).then(function(a){return b.extend(d,a,!0),a})}throw new Error("This entity has no resource")},c.prototype["delete"]=function(){if(this.resource)return this.resource["delete"].apply(this.resource,arguments);throw new Error("This entity has no resource")},c}),d("entity/property",["core","./entity","resource","utils"],function(a,b,c,d){function e(a){var b=a[0];if(d.isString(b)||"number"==typeof b)a[0]=[{value:b.toString()}];else if(d.isObject(b))if(b.value)a[0]=[b];else{a[0]=[];for(var c in b)a[0].push({key:c,value:b[c]})}return a}var f=function(){b.apply(this,arguments)};return f.prototype=Object.create(b.prototype),f.prototype.constructor=f,a.Property=f,{resourceConstructor:function(b){if(!this.resource)throw new Error("This Entity does not have a Resource.");var f,g=this.resource.path+"/properties";if(b){if(!d.isString(b))throw new TypeError("Property must be a key/name string");g+="/"+b}return f=new c(this.resource.scope,g,a.Property),f.update=function(){return c.prototype.update.apply(this,e(arguments))},f}}}),d("entity/action",["core","./entity","scope/scope","resource","utils","logger"],function(a,b,c,d,e,f){function g(a){var b=arguments;return(!a||e.isFunction(a))&&(b=Array.prototype.slice.call(arguments,0),b.unshift({})),b}function h(b,c){return b.constructor===a.Product?c.product=b.id:b.constructor===a.Thng&&(c.thng=b.id),c}function i(a,b,d){if(!(a instanceof c||a.id))throw new Error("This entity does not have an ID.");var e=b;return e.type=d,h(a,e),e}var j=function(){b.apply(this,arguments)};return j.prototype=Object.create(b.prototype),j.prototype.constructor=j,a.Action=j,{resourceConstructor:function(b,j){var k,l,m=this,n=this instanceof c?this:this.resource.scope;if(!b)throw new TypeError("Action type cannot be empty.");if(!e.isString(b))throw new TypeError("Action type must be a name string");return k="/actions/"+b,l=d.constructorFactory(k,a.Action).call(n,j),l.create=function(){var c=this,h=g.apply(this,arguments);return h[0]=i(m,h[0],b),a.settings.geolocation?e.getCurrentPosition().then(function(a){return h[0].location={latitude:a.coords.latitude,longitude:a.coords.longitude},h[0].locationSource="sensor",d.prototype.create.apply(c,h)},function(a){return f.info(a),d.prototype.create.apply(c,h)}):d.prototype.create.apply(c,h)},l.read=function(){var a=g.apply(this,arguments);return a[0].params=a[0].params||{},h(m,a[0].params),d.prototype.read.apply(this,a)},l}}}),d("entity/product",["core","./entity","resource","./property","./action","utils"],function(a,b,c,d,e,f){var g=function(){b.apply(this,arguments)};return g.prototype=Object.create(b.prototype),g.prototype.constructor=g,f.extend(g.prototype,{property:d.resourceConstructor,action:e.resourceConstructor},!0),a.Product=g,{resourceConstructor:c.constructorFactory("/products",a.Product)}}),d("entity/appUser",["core","./entity","resource","utils","ajax"],function(a,b,c,d){function e(b){if(!b||!d.isString(b))throw new Error("Activation code must be a string.");if(this.type&&"anonymous"===this.type)throw new Error("Anonymous users can't be validated.");var c=this.scope,e=this.path;return this.id&&(c=this.resource.scope,e=this.resource.path+"/"+this.id),a.api({url:e+"/validate",method:"post",authorization:c.apiKey,data:{activationCode:b}})}function f(){var b=this;return a.api({url:this.path,method:"post",params:{anonymous:!0},data:{},authorization:this.scope.apiKey}).then(function(c){var d=new a.User({id:c.evrythngUser,apiKey:c.evrythngApiKey,type:"anonymous"},b.scope);return d})}var g=function(a){var c=arguments;a.evrythngUser&&(a.id=a.evrythngUser,delete a.evrythngUser),c[0]=a,b.apply(this,c)};return g.prototype=Object.create(b.prototype),g.prototype.constructor=g,d.extend(g.prototype,{validate:function(){return e.call(this,this.activationCode)}},!0),a.AppUser=g,{resourceConstructor:function(b){var g=b||"/users";return function(b){var h=c.constructorFactory(g,a.AppUser).call(this,b);return h.validate=function(){return e.apply(this,arguments)},h.update=function(){if(this.scope.type&&"anonymous"===this.scope.type)throw new Error("Anonymous users are read-only.");return c.prototype.update.apply(this,arguments)},h.create=function(){var a=this,b=arguments[0];return d.isObject(b)&&b.anonymous===!0?f.call(a):c.prototype.create.call(a,b)},h}}}}),d("social/facebook",["npo","utils"],function(a,b){function c(b){return new a(function(a){window.fbAsyncInit=function(){FB.init({appId:b,version:"v2.0"}),FB.getLoginStatus(function(b){f(b).then(function(b){a(b)})})},function(a,b,c){var d,e=a.getElementsByTagName(b)[0];a.getElementById(c)||(d=a.createElement(b),d.id=c,d.src="//connect.facebook.net/en_US/sdk.js",e.parentNode.insertBefore(d,e))}(document,"script","facebook-jssdk")})}function d(b){return new a(function(a,c){FB.login(function(b){f(b).then(function(b){b.user?a(b):c(b)})},b)})}function e(){return new a(function(a){FB.logout(a)})}function f(c){return new a("connected"==c.status?function(a){FB.api("/me",function(d){a(b.extend(c,{user:d}))})}:function(a){a(c)})}return{init:c,login:d,logout:e}}),d("authentication",["core","npo","social/facebook","utils","ajax"],function(a,b,c,d){function e(a,b,c,e){var h=c,i=e;if(!a)throw new TypeError("Credentials (for Evrythng) or type (for Third party) are missing.");return d.isString(a)?"facebook"===a?f.call(this,b,h,i):"evrythng"===a?g.call(this,b,h,i):void 0:g.call(this,a,b,h)}function f(a,e,f){var g={scope:"email"},i=this;if(d.isFunction(a)||null===a){var j=e;e=a,f=j}else d.isObject(a)&&(g=a);return new b(function(a,b){c.login(g).then(function(b){h.call(i,b).then(function(b){e&&e(b),a(b)})},function(a){f&&f(a),b(a)})})}function g(a,b,c){if(!a||d.isFunction(a))throw new TypeError("Credentials are missing.");return i.call(this,a).then(function(a){return b&&b(a),a},function(a){throw c&&c(a),a})}function h(b){var c=this;return a.api({url:"/auth/facebook",method:"post",data:{access:{token:b.authResponse.accessToken}},authorization:this.apiKey}).then(function(e){var f=new a.User({id:e.evrythngUser,apiKey:e.evrythngApiKey},c);return d.extend(f,{facebook:b.user},!0),b.user=f,b})}function i(b){var c=this;return a.api({url:"/auth/evrythng",method:"post",data:b,authorization:this.apiKey}).then(function(b){return a.api({url:"/users/"+b.evrythngUser,authorization:b.evrythngApiKey}).then(function(e){var f=d.extend(e,{id:b.evrythngUser,apiKey:b.evrythngApiKey}),g=new a.User(f,c);return{user:g}})})}function j(a,b,c){return a&&d.isString(a)?"facebook"===a?k.call(this,b,c):"evrythng"===a?l.call(this,b,c):void 0:l.call(this,a,b)}function k(a,b){var d=this;return c.logout().then(function(){return l.call(d,a,b)})}function l(b,c){return a.api({url:"/auth/all/logout",method:"post",authorization:this.apiKey}).then(function(a){return b&&b(a),a},function(a){throw c&&c(a),a})}return{login:e,logout:j,authFacebook:h}}),d("scope/application",["core","./scope","resource","entity/product","entity/action","entity/appUser","authentication","social/facebook","utils","logger","ajax"],function(a,b,c,d,e,f,g,h,i,j){var k=function(c){var d=this;i.isObject(c)?b.call(this,c.apiKey):b.call(this,c),this.$init=a.api({url:"/applications",authorization:this.apiKey}).then(function(a){return delete a[0].appApiKey,i.extend(d,a[0],!0)},function(){j.error("There is no application with this API Key.")}).then(function(a){return c.facebook?a.socialNetworks&&a.socialNetworks.facebook?h.init(a.socialNetworks.facebook.appId).then(function(a){return"connected"===a.status?g.authFacebook.call(d,a):a}).then(function(b){return i.extend(b,{app:a})}):void j.error("The Facebook configuration for this application is incorrect."):a})};return k.prototype=Object.create(b.prototype),k.prototype.constructor=k,i.extend(k.prototype,{product:d.resourceConstructor,action:e.resourceConstructor,appUser:f.resourceConstructor("/auth/evrythng/users"),login:g.login},!0),a.App=k,a}),d("entity/thng",["core","./entity","resource","./property","./action","utils","ajax"],function(a,b,c,d,e,f){function g(){if(!this.product)throw new Error("Thng does not have a product.");if(!this.resource)throw new Error("Thng does not have a resource.");return this.resource.scope.product(this.product).read()}var h=function(){b.apply(this,arguments)};return h.prototype=Object.create(b.prototype),h.prototype.constructor=h,f.extend(h.prototype,{property:d.resourceConstructor,action:e.resourceConstructor,readProduct:g},!0),a.Thng=h,{resourceConstructor:c.constructorFactory("/thngs",a.Thng)}}),d("entity/collection",["core","./entity","resource","utils"],function(a,b,c,d){function e(b){if(!this.resource)throw new Error("This Entity does not have a Resource.");var d=this.resource.path+"/thngs";return c.constructorFactory(d,a.Thng).call(this.resource.scope,b)}var f=function(){b.apply(this,arguments)};return f.prototype=Object.create(b.prototype),f.prototype.constructor=f,d.extend(f.prototype,{thng:e},!0),a.Collection=f,{resourceConstructor:c.constructorFactory("/collections",a.Collection)}}),d("entity/multimedia",["core","./entity","resource"],function(a,b,c){var d=function(){b.apply(this,arguments)};return d.prototype=Object.create(b.prototype),d.prototype.constructor=d,a.Multimedia=d,{resourceConstructor:c.constructorFactory("/contents/multimedia",a.Multimedia)}}),d("scope/user",["core","./scope","entity/product","entity/thng","entity/appUser","entity/action","entity/collection","entity/multimedia","authentication","utils"],function(a,b,c,d,e,f,g,h,i,j){function k(b,c){var d={};return j.isString(b)?(d.q=b,d=j.extend(d,c)):(d=b,c&&j.extend(d,c,!0)),a.api({url:"/search",params:d,authorization:this.apiKey})}function l(){var a=this,b=e.resourceConstructor().call(this,this.id);return b.update(arguments).then(function(b){return j.extend(a,b,!0),b})}var m=function(a,c){j.isObject(a)?(b.call(this,a.apiKey),j.extend(this,a,!0)):b.call(this,a),c instanceof b&&(this.parentScope=c)};return m.prototype=Object.create(b.prototype),m.prototype.constructor=m,j.extend(m.prototype,{product:c.resourceConstructor,thng:d.resourceConstructor,action:f.resourceConstructor,collection:g.resourceConstructor,multimedia:h.resourceConstructor,logout:i.logout,search:k,update:l},!0),a.User=m,a}),d("evrythng",["scope/application","scope/user"],function(a){return a}),c("evrythng")});
//# sourceMappingURL=evrythng.min.map